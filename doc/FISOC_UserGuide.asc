FISOC User Guide
================

Framework for Ice Sheet - Ocean Coupling.  FISOC comprises a Fortran90 (f90) program and f90 
modules to couple an Ice Sheet Model (ISM) to an Ocean Model (OM) for the purpose of simulating 
marine ice sheets where ice-ocean interactions are thought to be important.


Building and running FISOC
==============

Pre-requisites:
ESMF must be installed with netcdf.  ***needs fortran and c libraries***Compiling netcdf to give the right libraries for ESMF can be 
fiddly.  As of early 2014 the notes in FISOC_ESMF_CompileNotes.asc were relevant.

An Ice Sheet Model (ISM) must be available.  Alternatively, the FISOC framework can be 
tested using the dummy ISM provided.

An Ocean Model (OM) must be available.  Alternatively, the FISOC framework can be 
tested using the dummy OM provided.

Note that the dummy models do not provide any physically meaningful outputs.

In order to use an ISM called ISM_name, you need to set the environment variable FISOC_ISM.  
If you use bash you can do this by adding the following line to your ~/.bashrc file:
export FISOC_ISM="dummy"

In order to use an OM called OM_name, you need to set the environment variable FISOC_OM.
If you use bash you can do this by adding the following line to your ~/.bashrc file:
export FISOC_OM="dummy"

To compile FISOC, simply run make in the top level FISOC directory.

Do not directly modify the files FISOC_ISM.f90 and FISOC_OM.f90.  These are copies made 
during the build (***this is a bit shoddy, needs rethinking).



FISOC code structures
=====================
You need basic familiarity with the ESMF coding structures in order to understand the FISOC design.
A goood place to get started is the "getting started" document.  At time of writing (Jan 2015) this 
can be found at:
http://www.earthsystemmodeling.org/users/getting_started.shtml

The FISOC hierarchy is caller -> parent -> everything else.

FISOC_caller.f90       The calling program, registers routines with ESMF
FISOC_parent.f90       ESMF gridded component, parent to ice and ocean components

Note: OM is for Ocean Model, and ISM is for Ice Sheet Model.

FISOC_coupler.f90    ESMF coupler component, handles regridding
FISOC_ISM.f90        ESMF gridded component, ice sheet model
FISOC_OM.f90         ESMF gridded component, ocean model


FISOC_config.rc is a Configuration file for FISOC.  Each component (ISM and OM) may also use its own 
configuration file(s).  Aspects of the configuration specific to the coupling***
example*** talk through required items in the config file***

Summary of phases:
Initialisation.
ISM_init_phase1 > coupler_init_phase1 > OM_init > coupler_init_phase2 > ISM_init_phase2
Run.
ISM_run > coupler_run_phase1 > OM_run > coupler_run_phase2
Finalise.
ISM_finalise > OM_finalise > coupler_finalise


Notes on extending the coupling to use different OM and ISM components:
Use the dummy fortran modules as a starting point: copy and modify them to suit your needs.  Note 
that their calling structures must remain the same to be consistent with FISOC parent and caller 
and the ESMF framework.  i.e. the "SetServices" routines, and the routines referred to by the 
"SetServices" routines must keep their names and argument lists unchanged.  

These modules serve as wrappers for your main ISM or OM code.  The main ISM or OM call structure 
must be made to be compatible with ESMF, which essentially means having seperate initialise, run 
and finalise calls.  See the ESMF documentation.

***think about initialisation: currently ISM1 then OM then ISM2. Think about sharing 
grid information: consistency checks or one model gets their grid/geometry from the other?

***more specifics about variables to exchange and about regridding.

***bring other notes from my external hard drive project directory here.

***something on developing: required structures within FISOC_ISM_XXX.f90 and the OM equivalent.

